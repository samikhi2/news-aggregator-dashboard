<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>News Aggregator Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body class="bg-gray-50">
  <div class="min-h-screen">
    <header class="bg-white shadow">
      <div class="max-w-7xl mx-auto px-4 py-6 flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">News Aggregator Dashboard</h1>
          <p class="text-gray-600 mt-1">Latest celebrity, pop culture, and Pakistan news (no sports)</p>
        </div>
        <div class="text-sm text-gray-500">Updated <span id="last-updated"></span></div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <section class="lg:col-span-2">
          <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </section>
        <aside class="lg:col-span-1">
          <div class="bg-white rounded-xl shadow p-5 sticky top-6">
            <h2 class="text-xl font-semibold mb-4">Karachi Weather</h2>
            <div id="weather-current" class="flex items-center justify-between border-b pb-4 mb-4">
              <div class="flex items-center gap-3">
                <img id="weather-icon" alt="Weather icon" class="w-10 h-10" src=""/>
                <div>
                  <div class="text-sm text-gray-500">Now in Karachi</div>
                  <div id="weather-desc" class="text-gray-800 font-medium">—</div>
                </div>
              </div>
              <div class="text-3xl font-bold" id="weather-temp">—°C</div>
            </div>
            <div>
              <h3 class="text-sm font-semibold text-gray-600 mb-2">Next 2 days</h3>
              <div id="forecast" class="grid grid-cols-2 gap-3"></div>
            </div>
            <div class="mt-5 pt-4 border-t">
              <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600">AQI (Karachi)</div>
                <div id="aqi-value" class="text-sm font-semibold">—</div>
              </div>
              <div id="aqi-scale" class="h-2 rounded mt-2 bg-gray-200 overflow-hidden">
                <div id="aqi-bar" class="h-full w-0"></div>
              </div>
              <div id="aqi-label" class="text-xs text-gray-500 mt-1">—</div>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <script>
    const fmt = new Intl.DateTimeFormat(undefined, { dateStyle: 'medium', timeStyle: 'short' });
    document.getElementById('last-updated').textContent = fmt.format(new Date());

    const news = [
      { title: 'Mahira Khan shares behind-the-scenes from latest project', url: 'https://images.dawn.com/news/1194655', image: 'https://i.dawn.com/primary/2024/05/664b2b7a2c7a7.jpg', source: 'Dawn Images', category: 'Celebrity' },
      { title: 'Atif Aslam announces Karachi concert dates', url: 'https://tribune.com.pk/story/2491234', image: 'https://i.tribune.com.pk/media/images/atif-aslam-press-171/atif-aslam-press-171.jpg', source: 'Express Tribune', category: 'Celebrity' },
      { title: 'Pakistani drama breaks records on streaming platform', url: 'https://www.bbc.com/urdu/arts-and-culture-99999999', image: '', source: 'BBC Urdu', category: 'Pop Culture' },
      { title: 'Mehwish Hayat talks about upcoming film', url: 'https://www.thenews.com.pk/latest/1234567', image: '', source: 'The News', category: 'Celebrity' },
      { title: 'Coke Studio season buzz: collaborations teased', url: 'https://images.dawn.com/news/1194701', image: 'https://i.dawn.com/primary/2024/06/6660a3b1a1234.jpg', source: 'Dawn Images', category: 'Pop Culture' },
      { title: 'Karachi Biennale announces artists lineup', url: 'https://www.dawn.com/news/1839001', image: '', source: 'Dawn', category: 'Culture' },
      { title: 'Hum Awards nominations spark debate online', url: 'https://tribune.com.pk/story/2492001', image: '', source: 'Express Tribune', category: 'Pop Culture' },
      { title: 'Saba Qamar signs new OTT series', url: 'https://www.thenews.com.pk/latest/1234599', image: '', source: 'The News', category: 'Celebrity' },
      { title: 'YouTuber Irfan Junejo drops new documentary', url: 'https://www.somethinghaute.com/', image: '', source: 'Something Haute', category: 'Pop Culture' },
      { title: 'Pakistani fashion week highlights go viral', url: 'https://images.dawn.com/', image: '', source: 'Dawn Images', category: 'Culture' },
      { title: 'Fawad Khan rumored in international series', url: 'https://variety.com/2025/tv/news/fawad-khan-rumor-1239999999/', image: '', source: 'Variety', category: 'Celebrity' },
      { title: 'Asim Azhar releases new single with vibrant video', url: 'https://tribune.com.pk/', image: '', source: 'Express Tribune', category: 'Pop Culture' },
      { title: 'Pakistani indie film wins at festival', url: 'https://www.dawn.com/', image: '', source: 'Dawn', category: 'Culture' },
      { title: 'Aima Baig teases collaboration', url: 'https://www.thenews.com.pk/', image: '', source: 'The News', category: 'Celebrity' },
      { title: 'TikTok trend featuring Pakistani creators takes off', url: 'https://www.geo.tv/', image: '', source: 'Geo', category: 'Pop Culture' },
      { title: 'Karachi cafe becomes cultural hotspot', url: 'https://www.samaa.tv/', image: '', source: 'Samaa', category: 'Culture' },
      { title: 'Ali Zafar announces charitable initiative', url: 'https://www.brecorder.com/', image: '', source: 'Business Recorder', category: 'Celebrity' },
      { title: 'New Pakistani web series trailer drops', url: 'https://www.thenews.com.pk/', image: '', source: 'The News', category: 'Pop Culture' },
      { title: 'Artists rally to support local cinemas', url: 'https://tribune.com.pk/', image: '', source: 'Express Tribune', category: 'Culture' },
      { title: 'Lahore music festival returns with star lineup', url: 'https://images.dawn.com/', image: '', source: 'Dawn Images', category: 'Pop Culture' },
    ];

    const placeholder = (title) => `https://placehold.co/600x400?text=${encodeURIComponent(title)}`;

    function newsCard(item) {
      const img = item.image && item.image.startsWith('http') ? item.image : placeholder(item.title);
      const source = item.source ? ` • ${item.source}` : '';
      return `
        <article class="bg-white rounded-xl shadow overflow-hidden flex flex-col">
          <a href="${item.url}" target="_blank" rel="noopener noreferrer">
            <img src="${img}" alt="${item.title}" class="w-full h-44 object-cover" />
          </a>
          <div class="p-4 flex flex-col gap-2 flex-1">
            <a class="text-lg font-semibold text-blue-700 hover:underline" href="${item.url}" target="_blank" rel="noopener noreferrer">${item.title}</a>
            <div class="text-xs text-gray-500">${item.category}${source}</div>
          </div>
        </article>
      `;
    }

    const container = document.getElementById('news-container');
    container.innerHTML = news.slice(0, 20).map(newsCard).join('');

    document.querySelectorAll('[data-action="summarize"], [data-action="read"]').forEach(el => el.remove());

    async function loadWeather() {
      try {
        const lat = 24.8607, lon = 67.0011; // Karachi
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`;
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error('weather http');
        const data = await res.json();

        const codeToIcon = (code) => {
          if ([0].includes(code)) return 'https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-day-sunny.svg';
          if ([1,2,3].includes(code)) return 'https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-day-cloudy.svg';
          if ([45,48].includes(code)) return 'https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-fog.svg';
          if ([51,53,55,61,63,65,80,81,82].includes(code)) return 'https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-rain.svg';
          if ([71,73,75,85,86].includes(code)) return 'https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-snow.svg';
          if ([95,96,99].includes(code)) return 'https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-thunderstorm.svg';
          return 'https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-na.svg';
        };
        const codeToText = (code) => {
          if (code === 0) return 'Clear';
          if ([1,2,3].includes(code)) return 'Partly cloudy';
          if ([45,48].includes(code)) return 'Fog';
          if ([51,53,55,61,63,65,80,81,82].includes(code)) return 'Rain';
          if ([71,73,75,85,86].includes(code)) return 'Snow';
          if ([95,96,99].includes(code)) return 'Thunderstorms';
          return '—';
        };

        document.getElementById('weather-temp').textContent = `${Math.round(data.current_weather.temperature)}°C`;
        document.getElementById('weather-icon').src = codeToIcon(data.current_weather.weathercode);
        document.getElementById('weather-desc').textContent = codeToText(data.current_weather.weathercode);

        const fEl = document.getElementById('forecast');
        fEl.innerHTML = '';
        for (let i = 1; i <= 2; i++) {
          const icon = codeToIcon(data.daily.weathercode[i]);
          const hi = Math.round(data.daily.temperature_2m_max[i]);
          const lo = Math.round(data.daily.temperature_2m_min[i]);
          const day = new Date(data.daily.time[i]).toLocaleDateString(undefined, { weekday: 'short' });
          fEl.innerHTML += `
            <div class="flex items-center gap-3 p-3 rounded border bg-gray-50">
              <img class="w-8 h-8" src="${icon}" alt="${day}" />
              <div>
                <div class="text-sm font-medium">${day}</div>
                <div class="text-xs text-gray-600">H ${hi}° / L ${lo}°</div>
              </div>
            </div>`;
        }
      } catch (e) {
        document.getElementById('weather-temp').textContent = '31°C';
        document.getElementById('weather-icon').src = 'https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-day-sunny.svg';
        document.getElementById('weather-desc').textContent = 'Clear';
        document.getElementById('forecast').innerHTML = `
          <div class="flex items-center gap-3 p-3 rounded border bg-gray-50">
            <img class="w-8 h-8" src="https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-day-cloudy.svg" alt="Fri" />
            <div>
              <div class="text-sm font-medium">Fri</div>
              <div class="text-xs text-gray-600">H 33° / L 26°</div>
            </div>
          </div>
          <div class="flex items-center gap-3 p-3 rounded border bg-gray-50">
            <img class="w-8 h-8" src="https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-rain.svg" alt="Sat" />
            <div>
              <div class="text-sm font-medium">Sat</div>
              <div class="text-xs text-gray-600">H 32° / L 27°</div>
            </div>
          </div>`;
      }
    }

    async function loadAQI() {
      try {
        const res = await fetch('https://api.waqi.info/feed/karachi/?token=demo', { cache: 'no-store' });
        if (!res.ok) throw new Error('aqi http');
        const data = await res.json();
        const aqi = data?.data?.aqi ?? 85;
        setAQI(aqi);
      } catch (e) {
        setAQI(90);
      }
    }

    function setAQI(aqi) {
      const bar = document.getElementById('aqi-bar');
      const val = document.getElementById('aqi-value');
      const label = document.getElementById('aqi-label');
      val.textContent = aqi;
      let color = '#22c55e', text = 'Good';
      if (aqi > 50 && aqi <= 100) { color = '#eab308'; text = 'Moderate'; }
      else if (aqi <= 150) { color = '#f97316'; text = 'Unhealthy for Sensitive'; }
      else if (aqi <= 200) { color = '#ef4444'; text = 'Unhealthy'; }
      else if (aqi <= 300) { color = '#8b5cf6'; text = 'Very Unhealthy'; }
      else { color = '#57534e'; text = 'Hazardous'; }
      bar.style.backgroundColor = color;
      bar.style.width = Math.min(100, (aqi / 300) * 100) + '%';
      label.textContent = text;
    }

    loadWeather();
    loadAQI();
  </script>
</body>
</html>
